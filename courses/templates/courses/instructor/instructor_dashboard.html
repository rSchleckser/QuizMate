{% extends 'courses/base.html' %}

{% block title %}Instructor Dashboard - QuizMate{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1>Instructor Dashboard</h1>

  <!-- Welcome Message -->
  <div class="alert alert-info" role="alert">
    <h4 class="alert-heading">Welcome, {{user_type}} {{user.username}}!</h4>
    <p>Here is an overview of your courses and students stats.</p>
  </div>

  <!-- Quick Stats -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-white bg-primary mb-3">
        <div class="card-body">
          <h5 class="card-title">Total Courses</h5>
          <p class="card-text">
            {{ courses.count }}
          </p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-success mb-3">
        <div class="card-body">
          <h5 class="card-title">Total Students</h5>
          <p class="card-text">
            {{ total_students }}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Course Management -->
  <h2>My Courses</h2>
  <a href="{% url 'course_create' %}" class="btn btn-primary mb-3">Add New Course</a>
  <div class="list-group">
    {% for course in courses %}
    <a href="{% url 'course_detail_instructor' course.id %}" class="list-group-item list-group-item-action">
      {% if course.image %}
      <img src="{{ course.image }}" alt="{{ course.name }}" class="img-fluid mb-2" style="max-width: 150px; height: auto;">
      {% endif %}
      <h5 class="mb-1">
        {{ course.name }}
      </h5>
      <p class="mb-1">
        {{ course.description }}
      </p>
      <small>Students Enrolled:
        {{ enrollment.student }}</small>
      <div class="btn-group mt-2" role="group">
        <a href="{% url 'course_edit' course.id %}" class="btn btn-warning btn-sm">Edit</a>
        <a href="{% url 'course_delete' course.id %}" class="btn btn-danger btn-sm">Delete</a>
      </div>
    </a>
    {% empty %}
    <p>No courses available.</p>
    {% endfor %}
  </div>


<!-- Student List -->
<h2 class="mt-4">Student List</h2>
<div class="list-group">
  {% for student in students %}
  <a href="{% url 'student_detail' student.id %}" class="list-group-item list-group-item-action">
    <h5 class="mb-1">
      {{ student.username }}
    </h5>
    <small>Enrolled Courses:
      {% for enrollment in student.enrollments.all %}
        {{ enrollment.course.name }}
      {% endfor %}
    </small>
  </a>
  {% empty %}
  <p>No students available.</p>
  {% endfor %}
</div>


  <!-- Statistics -->
  <h2 class="mt-4">Course Performance</h2>
  <p>View detailed analytics on student performance and course effectiveness.</p>
  
  <canvas id="studentProgressChart" width="400" height="200"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
      var ctx = document.getElementById('studentProgressChart').getContext('2d');
      var studentProgressChart = new Chart(ctx, {
          type: 'bar',
          data: {
              labels: [
                  {% for student in students %}
                      '{{ student.username }}',
                  {% endfor %}
              ],
              datasets: [
                  {
                      label: 'Progress of completion (%)',
                      data: [
                          {% for student in students %}
                              {{ student.avg_progress }},
                          {% endfor %}
                      ],
                      borderColor: 'rgba(75, 192, 192, 1)',
                      backgroundColor: 'rgba(75, 192, 192, 0.2)',
                      fill: true,
                  },
              ]
          },
          options: {
              responsive: true,
              scales: {
                  y: {
                      beginAtZero: true,
                      max: 100,
                      title: {
                          display: true,
                          text: 'Percentage (%)'
                      }
                  },
                  x: {
                      title: {
                          display: true,
                          text: 'Students'
                      }
                  }
              }
          }
      });
  });
  </script>

</div>
{% endblock %}